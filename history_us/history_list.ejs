<%- include ("../_headerusers") %>
    <link rel="stylesheet" href="/dist/css/user_menu.css">
    <div class="container-fluid mt-4">
        <div class="row">
            <div class="col-12">
                <div class="card">
                    <div class="d-flex border-bottom title-part-padding align-items-center">
                        <div>
                            <h4 class="card-title mb-0">ประวัติการใช้บริการ</h4>
                        </div>
                    </div>
                    <div class="card-body list-history-all">

                    </div>

                </div>
            </div>
        </div>
    </div>

    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <script>
        $.ajax({
            url: '/history_us/all',
            method: 'POST',
            success: (data) => {
                const form_history_list = document.querySelector('.list-history-all')
                for (var i = 0; i < data.hl.length; i++) {
                    const idmenufind = data.hl[i].idmenu
                    const date_res = data.hl[i].date_res;
                    const idres = data.hl[i].idres;
                    const status_al = data.hl[i].status_al;
                    if (data.hl[i].menu_page == 1) {
                        $.ajax({
                            url: '/history_us/allname_mm',
                            method: 'POST',
                            data: { idmenufind, date_res, idres, status_al },
                            success: (mm) => {
                                console.log("mm", mm);
                                const date_res = mm.date_res.split('T')
                                const format_date = date_res[0].split('-')
                                const date_th = format_date[2] + '/' + format_date[1] + '/' + (Number(format_date[0]) + 543).toString();
                                const time_res = date_res[1].split('.')
                                form_history_list.innerHTML += '<div class="form-group row py-3">'
                                    + '<label class="control-label text-start col-md-4 font-weight-medium">ประเภทการใช้บริการ: <span class="font-weight-medium" style="float: right !important;"> ' + mm.name_mm + ' </span></label>'
                                    + '<label class="control-label text-start col-md-4 font-weight-medium">วันที่: <span class="font-weight-medium" style="float: right !important;"> ' + date_th + '</span></label>'
                                    + '<label class="control-label text-start col-md-4 font-weight-medium">เวลา: <span class="font-weight-medium" style="float: right !important;"> ' + time_res[0] + ' </span></label>'
                                    + '<div class="col-md-8 mt-2">'
                                    + ' <a  href="/history_us/detail_hl'+mm.idres+'" class="btn btn-info form-control-static"> ดูรายละเอียด </a>'
                                    + '</div></div><hr>'
                            }
                        })
                    } else {
                        $.ajax({
                            url: '/history_us/allname_ms',
                            method: 'POST',
                            data: { idmenufind, date_res, idres, status_al },
                            success: (ms) => {
                                console.log("ms", ms);
                                const date_res = ms.date_res.split('T')
                                const format_date = date_res[0].split('-')
                                const date_th = format_date[2] + '/' + format_date[1] + '/' + (Number(format_date[0]) + 543).toString();
                                const time_res = date_res[1].split('.')
                                form_history_list.innerHTML += '<div class="form-group row py-3">'
                                    + '<label class="control-label text-start col-md-4 font-weight-medium">ประเภทการใช้บริการ: <span class="font-weight-medium" style="float: right !important;"> ' + ms.name_ms + ' </span></label>'
                                    + '<label class="control-label text-start col-md-4 font-weight-medium">วันที่: <span class="font-weight-medium" style="float: right !important;"> ' + date_th + '</span></label>'
                                    + '<label class="control-label text-start col-md-4 font-weight-medium">เวลา: <span class="font-weight-medium" style="float: right !important;"> ' + time_res[0] + ' </span></label>'
                                    + '<div class="col-md-8 mt-2">'
                                    + '<a href="/history_us/detail_hl'+ms.idres+'" class="btn btn-info form-control-static"> ดูรายละเอียด </a>'
                                    + '</div></div><hr>'
                            }
                        })
                    }
                }
            }
        })
    </script>
    <%- include ("../_footerusers") %>